library(shiny)
library(reshape2)
library(gridExtra)
library(ggplot2)
library(plyr)
library(scales)
shinyServer(function(input, output) {
   df <- source('Dynamic Plot/data.R')
  output$LeadsPlot <- renderPlot({
    environment<-environment()
     data=subset(leads_date_generator,Lead.Generator==input$y.factor)
    df = subset(data,as.Date(as.character(Date.Created)) >= input$dateRange[1]&as.Date(as.character(Date.Created)) <= input$dateRange[2])
    p <- ggplot(df,aes(x=Date.Created, y=freq),environment = environment)
    p <- p+ geom_line()+geom_point(size=4, shape=21, fill="white")+
      ggtitle(paste("Leads Generated by",input$y.factor))+
      xlab("Date")+
      ylab("No of Leads")+
      scale_x_datetime(breaks = date_breaks("1 day"))+theme_bw()+
      theme(axis.text.x = element_text(angle = 45, hjust = 1))
      
    print(p)
  })
  output$LeadsTable <- renderDataTable({
    df <- aggregate(leads_date_generator$freq,by = list(leads_date_generator$Lead.Generator),FUN = sum)
    names(df) <- c("Sale_rep","No of Leads")
    df
 }, options = list(lengthMenu = c(5, 10, 15), pageLength = 5))
 })